// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  MANAGER
  DEPUTY
  STAFF
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  role          UserRole  @default(STAFF)
  
  workspace     Workspace @relation(fields: [workspaceId], references: [id])
  workspaceId   String

  staff         Staff?    @relation(fields: [staffId], references: [id])
  staffId       String?   @unique

  sessions      Session[]

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Session {
  id        String   @id
  userId    String
  expiresAt DateTime
  user      User     @relation(references: [id], fields: [userId], onDelete: Cascade)
}

model Workspace {
  id        String   @id @default(cuid())
  name      String
  
  users     User[]
  staff     Staff[]
  beds      Bed[]
  shifts    Shift[]
  settings  WorkspaceSettings?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model WorkspaceSettings {
  id              String    @id @default(cuid())
  workspace       Workspace @relation(fields: [workspaceId], references: [id])
  workspaceId     String    @unique
  
  minRestHours    Int       @default(11)
  maxOvertime     Int       @default(48)
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

model Staff {
  id            String   @id @default(cuid())
  firstName     String
  lastName      String
  contractHours Int      @default(37)
  
  workspace     Workspace @relation(fields: [workspaceId], references: [id])
  workspaceId   String

  user          User?
  skills        Skill[]
  availability  Availability[]
  assignments   ShiftAssignment[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Skill {
  id          String   @id @default(cuid())
  name        String   @unique
  staff       Staff[]
}

model Bed {
  id          String   @id @default(cuid())
  name        String
  
  workspace     Workspace @relation(fields: [workspaceId], references: [id])
  workspaceId   String

  assignments BedAssignment[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model BedAssignment {
  id          String   @id @default(cuid())
  bed         Bed      @relation(fields: [bedId], references: [id])
  bedId       String
  
  patientAcuity Int      @default(1) // 1-5 scale
  startTime     DateTime @default(now())
  endTime       DateTime?

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Shift {
  id          String   @id @default(cuid())
  startTime   DateTime
  endTime     DateTime
  
  workspace     Workspace @relation(fields: [workspaceId], references: [id])
  workspaceId   String

  assignments ShiftAssignment[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model ShiftAssignment {
  id      String @id @default(cuid())
  shift   Shift  @relation(fields: [shiftId], references: [id])
  shiftId String
  staff   Staff  @relation(fields: [staffId], references: [id])
  staffId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Availability {
  id        String    @id @default(cuid())
  staff     Staff     @relation(fields: [staffId], references: [id])
  staffId   String
  
  startTime DateTime
  endTime   DateTime
  type      String    // e.g., "TIME_OFF", "UNAVAILABLE"

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}
